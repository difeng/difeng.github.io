<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>difeng</title>
  <meta name="author" content="difeng">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="difeng"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="difeng" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">difeng</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-03-05T15:27:59.000Z"><a href="/2016/03/05/spring-01/">2016-03-05</a></time>
      
      
  
    <h1 class="title"><a href="/2016/03/05/spring-01/">spring框架简介</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1-简介">1.简介</h3><pre><code><span class="keyword">spring</span>是优秀的开源框架，是为解决复杂的企业应用程序开发而创建的。
</code></pre><h3 id="2-_spring框架的构成和各个模块的作用和简述">2. spring框架的构成和各个模块的作用和简述</h3><p>spring框架有6个定义明确的模块组成，如下图所指示<br><img src="http://7xawio.com1.z0.glb.clouddn.com/spring_models.png" alt="spring 模块图"></p>
<ul>
<li><p>spring的容器<br>负责spring应用中Bean的创建，配置和管理，主要组件是 BeanFactory。BeanFactory使用控制反转（IOC）模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。</p>
</li>
<li><p>spring的AOP模块<br>面向切面编程，AOP可以帮助应用程序解耦，借助于AOP可以将应用的关注点（例如事务和安全）从它们所在的应用对象中解耦出来。</p>
</li>
<li>instrumentation监测器<br>spring-instrument模块提供了类的检测支持，并且类的加载器实现可以被用于特定应用服务中。spring-instrument-tomcat模块包含了Spring给Tomcat提供的监测代理。 </li>
<li><p>数据库访问与集成<br>封装了JDBC，提供了DAO<br>集成了第三方的ORM框架</p>
</li>
<li><p>web和远程调用<br>集成了市面上流行的MVC框架<br>web和远程调用模块自带了一个强大的MVC框架，有助于应用提升web层的松散耦合<br>远程调用集成了RMI，HESSION，Burlap，jax-ws<br>自带远程调用框架：HTTP invoker</p>
</li>
<li><p>测试<br>spring提供了测试模块来测试spring的应用。</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-02-27T16:03:10.000Z"><a href="/2016/02/28/lifegame/">2016-02-28</a></time>
      
      
  
    <h1 class="title"><a href="/2016/02/28/lifegame/">生命游戏</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1-_生命游戏简介：">1. 生命游戏简介：</h3><p>  生命游戏(Life Game)是英国数学家约翰·何顿·康威在1970年发明的细胞自动机。它是由3条规则构成的二维元胞自动机(2D Cellular Automata)。</p>
<h3 id="2-_原理">2. 原理</h3><p>在有N*N个格子的平面上，把每一个格子都可以看成是一个生命体，每个生命都有生和死两种状态，如果该格子生就显示蓝色，死则显示白色。每一个格子旁边都有邻居格子存在，如果我们把3*3的9个格子构成的正方形看成一个基本单位的话，那么这个正方形中心的格子的邻居就是它旁边的8个格子。<br>每个格子的生死遵循下面的原则：<br>1． 如果一个细胞周围有3个细胞为生（一个细胞周围共有8个细胞），则该细胞为生（即该细胞若原先为死，则转为生，若原先为生，则保持不变） 。<br>2． 如果一个细胞周围有2个细胞为生，则该细胞的生死状态保持不变；<br>3． 在其它情况下，该细胞为死（即该细胞若原先为生，则转为死，若原先为死，则保持不变）</p>
<h3 id="3-_代码实现">3. 代码实现</h3><p>功能：</p>
<h4 id="1-全屏显示滑翔机发射器的演化过程如下图：">1.全屏显示滑翔机发射器的演化过程如下图：</h4><p><img src="http://7xawio.com1.z0.glb.clouddn.com/lifegame_plant.png" alt="滑翔机发射器演示图"></p>
<h4 id="2-_按“Esc”键程序退出">2. 按“Esc”键程序退出</h4><blockquote>
<p>类说明：<br>Canvas.java       画布类，封装了细胞演化的算法<br>Cell.java        细胞单元的类<br>Constant.java    常量类<br>MainFrame.java   主控程序</p>
</blockquote>
<p>算法思路：<br>用三个链表，cellList(活着的细胞)，bornCellList(刚出生的细胞)，deadCellList（死去得细胞），遍历cellList，对每个细胞按规则进行繁衍，繁衍一代后，处理cellList，从中去掉deadCellList，加入bornCellList。在如此可完成一轮的繁衍，其中还要用到一个二维数组flagArr来保存细胞状态。<br>二维数组表示细胞的状态<br>取值为1 和 2   1:当代存活的细胞      2:刚产生的下一代细胞<br>int [][] flagArr;<br>活着的细胞链表<br>List<cell> cellList = new LinkedList<cell>();<br>新生代的细胞链表<br>List<cell> bornCellList = new LinkedList<cell>();<br>死亡的细胞链表<br>List<cell> deadCellList = new LinkedList<cell>();</cell></cell></cell></cell></cell></cell></p>
<ol>
<li>清空bornCellList，deadCellList</li>
<li>遍历cellList，对每个细胞按规则进行演化</li>
<li>2步骤后deadCellList里面会有一些死去的细胞，遍历deadCellList，将其中细胞的状态标记到flagArr中。<pre><code><span class="keyword">for</span>(Cell <span class="keyword">ce</span><span class="variable">l:deadCellList</span>)
    flagArr[cel.row][cel.<span class="built_in">col</span>] = <span class="number">0</span>;
</code></pre>从活着的细胞列表中去掉在下一代将要死掉的<br>cellList.removeAll(deadCellList);<br>将下一代新生成的细胞标记为当代存活的细胞<pre><code><span class="keyword">for</span>(Cell <span class="keyword">ce</span><span class="variable">l:bornCellList</span>)
    flagArr[cel.row][cel.<span class="built_in">col</span>]=<span class="number">1</span>;
</code></pre>将新生成的细胞加入到活着的细胞列表中<pre><code>cellList.addAll<span class="comment">(bornCellList)</span>;
</code></pre></li>
</ol>
<p>重复执行1到3的步骤，每重复一次，重绘整个细胞面板<br>Canvas代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.difeng.lifegame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.difeng.lifegame.Constant.CELL_HEIGHT;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.difeng.lifegame.Constant.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JPanel;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> difeng</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Canvas</span> <span class="keyword">extends</span> <span class="title">JPanel</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//取值为1 和 2   1:当代存活的细胞      2:刚产生的下一代细胞</span></span><br><span class="line">	<span class="keyword">int</span> [][] flagArr;</span><br><span class="line">	<span class="comment">//活着的细胞</span></span><br><span class="line">	List&lt;Cell&gt; cellList = <span class="keyword">new</span> LinkedList&lt;Cell&gt;();</span><br><span class="line">	<span class="comment">//新生的细胞</span></span><br><span class="line">	List&lt;Cell&gt; bornCellList = <span class="keyword">new</span> LinkedList&lt;Cell&gt;();</span><br><span class="line">	<span class="comment">//死亡的细胞</span></span><br><span class="line">	List&lt;Cell&gt; deadCellList = <span class="keyword">new</span> LinkedList&lt;Cell&gt;();</span><br><span class="line">	<span class="comment">//方向数组</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">int</span> [][] dir = &#123;</span><br><span class="line">			&#123;-<span class="number">1</span>,-<span class="number">1</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;,</span><br><span class="line">			&#123;-<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;,</span><br><span class="line">			&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,-<span class="number">1</span>&#125;,</span><br><span class="line">			&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="comment">//滑翔机发射器的图案矩阵</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span>[][] plant = &#123;</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,	</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,</span><br><span class="line">    		&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;	</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Canvas</span><span class="params">()</span></span>&#123;</span><br><span class="line">		setBackground(Color.black);</span><br><span class="line">		init();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 * 初始化</span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		CELL_WIDTH = <span class="number">20</span>;</span><br><span class="line">		CELL_HEIGHT = <span class="number">20</span>;</span><br><span class="line">		COL_NUM = SCREEN_WIDTH/CELL_WIDTH;</span><br><span class="line">		ROW_NUM= SCREEN_HEIGHT/CELL_HEIGHT;</span><br><span class="line">		flagArr = <span class="keyword">new</span> <span class="keyword">int</span>[ROW_NUM][COL_NUM];</span><br><span class="line">		<span class="comment">//滑翔机发射器的起始坐标</span></span><br><span class="line">		<span class="keyword">int</span> x = <span class="number">5</span>,y=<span class="number">5</span>;</span><br><span class="line">		<span class="comment">//将滑翔机发射器的图案初始化到</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; plant.length;i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; plant[<span class="number">0</span>].length;j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(plant[i][j] == <span class="number">1</span>)&#123;</span><br><span class="line">					<span class="keyword">int</span> r = x + i;</span><br><span class="line">					<span class="keyword">int</span> col = y + j;</span><br><span class="line">					<span class="keyword">if</span>(flagArr[r][col]==<span class="number">0</span>)&#123;</span><br><span class="line">						Cell cel = <span class="keyword">new</span> Cell(r, col,<span class="keyword">true</span>);</span><br><span class="line">						cellList.add(cel);</span><br><span class="line">						flagArr[r][col] = <span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evolution</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//清空中间计算的列表</span></span><br><span class="line">		bornCellList.clear();</span><br><span class="line">		deadCellList.clear();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//遍历当代细胞列表，让细胞开始繁衍生长，计算下一代的状态</span></span><br><span class="line">		<span class="keyword">for</span>(Cell cel:cellList)&#123;</span><br><span class="line">			<span class="comment">//细胞生长</span></span><br><span class="line">			cellEvolution(cel); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将下一代将要死掉的细胞标记为死亡</span></span><br><span class="line">		<span class="keyword">for</span>(Cell cel:deadCellList)&#123;</span><br><span class="line">			flagArr[cel.row][cel.col] = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//从活着的细胞列表中去掉在下一代将要死掉的</span></span><br><span class="line">		cellList.removeAll(deadCellList);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将下一代新生成的细胞标记为当代存活的细胞</span></span><br><span class="line">		<span class="keyword">for</span>(Cell cel:bornCellList)&#123;</span><br><span class="line">			flagArr[cel.row][cel.col]=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//将新生成的细胞加入到活着的细胞列表中</span></span><br><span class="line">		cellList.addAll(bornCellList);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">paintComponent</span><span class="params">(Graphics g)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.paintComponent(g);</span><br><span class="line">		<span class="comment">//绘制细胞棋盘</span></span><br><span class="line">		g.setColor(<span class="keyword">new</span> Color(<span class="number">33</span>,<span class="number">33</span>,<span class="number">33</span>));</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=ROW_NUM;i++)&#123;</span><br><span class="line">			g.drawLine(<span class="number">0</span>,i*CELL_HEIGHT,SCREEN_WIDTH,i*CELL_HEIGHT);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=COL_NUM;i++)&#123;</span><br><span class="line">			g.drawLine(i*CELL_WIDTH,<span class="number">0</span>,i*CELL_WIDTH,SCREEN_HEIGHT);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//开始画细胞</span></span><br><span class="line">		g.setColor(Color.GREEN);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;cellList.size();i++)&#123;</span><br><span class="line">			Cell cel = cellList.get(i);</span><br><span class="line">			<span class="keyword">if</span>(cel!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				g.fill3DRect(cel.col*CELL_WIDTH,cel.row*CELL_HEIGHT,CELL_WIDTH,CELL_HEIGHT,<span class="keyword">true</span>);		</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 细胞繁衍</span><br><span class="line">	 * <span class="doctag">@param</span> cel</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">cellEvolution</span><span class="params">(Cell cel)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> row = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> col = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> cellNum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dir.length;i++)&#123;</span><br><span class="line">			row = cel.row + dir[i][<span class="number">0</span>];</span><br><span class="line">			col = cel.col + dir[i][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span>(row&gt;-<span class="number">1</span> &amp;&amp; row&lt;ROW_NUM &amp;&amp; col&gt;-<span class="number">1</span> &amp;&amp; col&lt;COL_NUM)&#123;</span><br><span class="line">				<span class="keyword">if</span>(flagArr[row][col]==<span class="number">1</span>)&#123;</span><br><span class="line">					cellNum++;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">//此位置周围有三个存活的细胞且此位置暂无生成的新细胞，则此位置应产生一个细胞</span></span><br><span class="line">					<span class="keyword">if</span>(computeRound(row,col) == <span class="number">3</span> &amp;&amp; flagArr[row][col] != <span class="number">2</span>)&#123;</span><br><span class="line">						Cell newCell = <span class="keyword">new</span> Cell(row, col,<span class="keyword">true</span>);</span><br><span class="line">						<span class="comment">//标志此位置新生成一个细胞</span></span><br><span class="line">						flagArr[row][col] = <span class="number">2</span>;</span><br><span class="line">						bornCellList.add(newCell);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;  </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//细胞死亡判断条件</span></span><br><span class="line">		<span class="keyword">if</span>(cellNum &lt; <span class="number">2</span> || cellNum &gt; <span class="number">3</span>)&#123;</span><br><span class="line">			deadCellList.add(cel);  </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 计算一个细胞周围有多少个存活的细胞</span><br><span class="line">	 * <span class="doctag">@param</span> row</span><br><span class="line">	 * <span class="doctag">@param</span> col</span><br><span class="line">	 * <span class="doctag">@return</span></span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">int</span> <span class="title">computeRound</span><span class="params">(<span class="keyword">int</span> row,<span class="keyword">int</span> col)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> cellNum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> r=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> cl=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;dir.length;i++)&#123;</span><br><span class="line">			r = row + dir[i][<span class="number">0</span>];</span><br><span class="line">			cl =  col + dir[i][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span>(r &gt; -<span class="number">1</span> &amp;&amp; r &lt; ROW_NUM &amp;&amp; cl &gt; -<span class="number">1</span> &amp;&amp; cl &lt; COL_NUM)&#123;</span><br><span class="line">				<span class="keyword">if</span>(flagArr[r][cl]==<span class="number">1</span>)&#123;</span><br><span class="line">					cellNum++;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cellNum;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(REFRESH_INTERVALS);</span><br><span class="line">				<span class="comment">//重新绘制</span></span><br><span class="line">				repaint();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			evolution();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Cell代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.difeng.lifegame;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> difeng</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cell</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span>  row;</span><br><span class="line">      <span class="keyword">int</span>  col;</span><br><span class="line">      <span class="keyword">boolean</span> islive;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Cell</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col, <span class="keyword">boolean</span> islive)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.row = row;</span><br><span class="line">		<span class="keyword">this</span>.col = col;</span><br><span class="line">		<span class="keyword">this</span>.islive = islive;</span><br><span class="line">	&#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Constant的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.difeng.lifegame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Dimension;</span><br><span class="line"><span class="keyword">import</span> java.awt.Toolkit;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> difeng</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constant</span> </span>&#123;</span><br><span class="line">     <span class="keyword">static</span> Dimension dimension = Toolkit.getDefaultToolkit().getScreenSize();</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> SCREEN_WIDTH = (<span class="keyword">int</span>) dimension.getWidth();</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> SCREEN_HEIGHT = (<span class="keyword">int</span>)dimension.getHeight();</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> ROW_NUM;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> COL_NUM;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CELL_WIDTH = <span class="number">20</span>;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CELL_HEIGHT = <span class="number">20</span>;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REFRESH_INTERVALS = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>主控程序:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.difeng.lifegame;</span><br><span class="line"><span class="keyword">import</span> java.awt.BorderLayout;</span><br><span class="line"><span class="keyword">import</span> java.awt.GraphicsDevice;</span><br><span class="line"><span class="keyword">import</span> java.awt.GraphicsEnvironment;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyAdapter;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.JFrame;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> difeng</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainFrame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		JFrame life = <span class="keyword">new</span> JFrame();</span><br><span class="line">		Canvas canvas = <span class="keyword">new</span> Canvas();</span><br><span class="line">		GraphicsDevice gd = GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice();</span><br><span class="line">	    life.getContentPane().add(canvas,BorderLayout.CENTER);</span><br><span class="line">	    life.setUndecorated(<span class="keyword">true</span>);</span><br><span class="line">	    <span class="comment">//设置全屏显示</span></span><br><span class="line">	    gd.setFullScreenWindow(life);</span><br><span class="line">	    <span class="comment">//添加程序退出的事件监听</span></span><br><span class="line">	    life.addKeyListener(<span class="keyword">new</span> KeyAdapter() &#123;</span><br><span class="line">	    	<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">				<span class="keyword">super</span>.keyPressed(e);</span><br><span class="line">				<span class="keyword">if</span>(e.getKeyCode()==KeyEvent.VK_ESCAPE)&#123;</span><br><span class="line">					System.exit(<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	    <span class="keyword">new</span> Thread(canvas).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="4-_总结">4. 总结</h3><p>1.搞清楚问题的本质，也就是原理部分。<br>2.然后思考寻找合理的数据结构。再考虑类的设计和协作。<br>3.coding<br>生命游戏还有其他游戏的算法来高效的实现，上述只是自己刚接触时的想法。不过这个游戏确实挺有意思的，其实它也属于分形学。有兴趣的朋友还可以阅读《混沌与分形》这本书。也可以去看看极客们制作的漂亮额分形图形<a href="http://www.douban.com/note/54115757/" target="_blank" rel="external">http://www.douban.com/note/54115757/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-14T15:22:19.000Z"><a href="/2016/01/14/countdownlatch-demo/">2016-01-14</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/14/countdownlatch-demo/">CountDownlatch的使用</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="适用场景：">适用场景：</h3><p>一个任务的执行要等到所有任务都执行完后再做操作。</p>
<h3 id="具体用法">具体用法</h3><p>以下面的场景为例：</p>
<table>
<thead>
<tr>
<th>任务</th>
<th style="text-align:right">执行条件   </th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td style="text-align:right">无</td>
</tr>
<tr>
<td>B</td>
<td style="text-align:right">无</td>
</tr>
<tr>
<td>C</td>
<td style="text-align:right">无</td>
</tr>
<tr>
<td>D</td>
<td style="text-align:right">A、B、C全部执行完</td>
</tr>
</tbody>
</table>
<p>实现步骤：<br>1.在主线程处新建线程池，用于执行任务。<br>2.新建CountDownLatch实例latch，指定count值。<br>3.A、B、C三个任务共用同一个CountDownLatch实例latch，在A、B、C的每个任务执行方法的最后调用CountDownLatch的countDown()方法。<br>4.在要等待的任务D的执行位置的开始处调用CountDownLatch实例latch的await()方法来等待A、B、C三个任务的执行完成。</p>
<p><strong>说明</strong>：<br>  具体使用时，A、B、C、D可为独立于主线程的四个单独的线程，也可以是A、B、C是三个独立线程，而D做为主线程来等待A、B、C的完成。</p>
<p>下边以一个具体的实例来做一个示范。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> difeng</span><br><span class="line"> * </span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">		CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">3</span>);</span><br><span class="line">		Producer worker1 = <span class="keyword">new</span> Producer(<span class="string">"producer1"</span>,<span class="string">"partA"</span>,countDownLatch);	</span><br><span class="line">		Producer worker2 = <span class="keyword">new</span> Producer(<span class="string">"producer2"</span>,<span class="string">"partB"</span>,countDownLatch);	</span><br><span class="line">		Producer worker3 = <span class="keyword">new</span> Producer(<span class="string">"producer3"</span>,<span class="string">"partC"</span>,countDownLatch);</span><br><span class="line">		executorService.execute(worker1);</span><br><span class="line">		executorService.execute(worker2);</span><br><span class="line">		executorService.execute(worker3);</span><br><span class="line">	        executorService.execute(<span class="keyword">new</span> AssemblyWorker(countDownLatch));</span><br><span class="line">		executorService.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 构件生产者</span><br><span class="line"> * <span class="doctag">@author</span> difeng</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	String name;</span><br><span class="line">	CountDownLatch countDownLatch;</span><br><span class="line">	String partName;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(String name,String partName,CountDownLatch countDownLatch)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.partName = partName;</span><br><span class="line">		<span class="keyword">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"I am "</span> + <span class="keyword">this</span>.name + <span class="string">",I am  making the "</span> + <span class="keyword">this</span>.partName);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>) * <span class="number">1000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"I am "</span> + <span class="keyword">this</span>.name + <span class="string">",My work is done,I submit the "</span> + <span class="keyword">this</span>.partName + <span class="string">" to AssemblyWorker"</span>);</span><br><span class="line">		<span class="keyword">this</span>.countDownLatch.countDown();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 组装者</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssemblyWorker</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	CountDownLatch countDownLatch;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AssemblyWorker</span><span class="params">(CountDownLatch countDownLatch)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"I am AssemblyWorker,I am waitting for the workers to submit their component"</span>);</span><br><span class="line">			<span class="keyword">this</span>.countDownLatch.await();</span><br><span class="line">			System.out.println(<span class="string">"all work has done,I am assembled"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">I am producer2,I am  making the partB</span><br><span class="line">I am producer3,I am  making the partC</span><br><span class="line">I am producer1,I am  making the partA</span><br><span class="line">I am producer3,My work is done,I submit the partC to AssemblyWorker</span><br><span class="line">I am AssemblyWorker,I am waitting <span class="keyword">for</span> the workers to submit their component</span><br><span class="line">I am producer1,My work is done,I submit the partA to AssemblyWorker</span><br><span class="line">I am producer2,My work is done,I submit the partB to AssemblyWorker</span><br><span class="line">all work has done,I am assembled</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-10T12:15:03.000Z"><a href="/2016/01/10/jmeter-test/">2016-01-10</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/10/jmeter-test/">jmeter使用</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1-简介：">1.简介：</h3><p>JMeter是Apache下开源的性能测试工具组织的开放源代码项目，它是功能和性能测试的工具，JMeter是Apache下开源的性能测试工具组织的开放源代码项目，它是功能和性能测试的工具，Jmeter可以用来测试性能静态和动态的资源（Web服务（SOAP/ REST），网页动态语言PHP，Java和ASP.NET，文件等，Java对象，数据库和查询，FTP服务器和更多）。它可以被用来模拟一个重负载作用于服务器，组服务器，网络或对象，以测试它的强度或以分析在不同负载类型的整体性能。并且可以用它做性能的图形分析或重并发负载下测试服务器/脚本/对象的行为。<br>官网地址<a href="http://jmeter.apache.org/" target="_blank" rel="external">http://jmeter.apache.org/</a></p>
<h3 id="2-使用">2.使用</h3><h4 id="2-1-web性能测试，这里以静态web资源服务器为例进行测试。">2.1.web性能测试，这里以静态web资源服务器为例进行测试。</h4><h4 id="2-1-1_打开jmeter性能测试工具如下">2.1.1 打开jmeter性能测试工具如下</h4><p><img src="http://7xawio.com1.z0.glb.clouddn.com/jmeter_web_wecolme.png" alt="jmeter欢迎界面"></p>
<h4 id="2-1-2_新建测试计划(Test_Plan)">2.1.2 新建测试计划(Test Plan)</h4><p>a.先建线程组<br><img src="http://7xawio.com1.z0.glb.clouddn.com/jmeter_web_thread_group.png" alt="新建线程组"><br>b.在线程组上可以添加<br>逻辑控制（Logic Controller）<br>配置元件（Config Elements）<br>实例产生控制器（Sample Generating Controllers）<br>监听器(Listener)<br>定时器（Timer）<br>前置处理器<br>后置处理器</p>
<p>c.设置负载信息<br>线程属性信息设置</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>意思</th>
</tr>
</thead>
<tbody>
<tr>
<td>线程数</td>
<td>线程组中线程的个数</td>
</tr>
<tr>
<td>Ramp-up period</td>
<td>用于告知JMeter 要在多长时间内建立全部的线程。默认值是0。如果未指定ramp-up period ，也就是说ramp-up period 为零， JMeter 将立即建立所有线程，假设ramp-up period 设置成T 秒， 全部线程数设置成N个， JMeter 将每隔T/N秒建立一个线程。 </td>
</tr>
<tr>
<td>循环次数</td>
<td>请求发生的重复次数，若线程数为10,循环次数为10,则总的请求次数为10*10=100个</td>
</tr>
</tbody>
</table>
<h4 id="2-1-3_下面是以mina的SocketSever为例，简单介绍一下使用方法-">2.1.3 下面是以mina的SocketSever为例，简单介绍一下使用方法.</h4><p>a.先编写测试的代码<br>  jmeter提供了抽象的实例产生器AbstractJavaSamplerClient,我们只要新建自己的实例发生器并继承于AbstractJavaSamplerClient类,并实现其抽象方法<br>public SampleResult runTest(JavaSamplerContext arg0)，在此方法中实现我们实例发生器的调用，并返回结果对象SampleResult。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.jmeter.protocol.java.sampler.AbstractJavaSamplerClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.jmeter.protocol.java.sampler.JavaSamplerContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.jmeter.samplers.SampleResult;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * <span class="doctag">@Description</span>:TODO</span><br><span class="line"> * <span class="doctag">@author</span>:difeng</span><br><span class="line"> * <span class="doctag">@time</span>:2015年12月20日 下午11:16:39</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClient</span> <span class="keyword">extends</span> <span class="title">AbstractJavaSamplerClient</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> SampleResult <span class="title">runTest</span><span class="params">(JavaSamplerContext arg0)</span> </span>&#123;</span><br><span class="line">		SampleResult sr = <span class="keyword">new</span> SampleResult();</span><br><span class="line">		<span class="keyword">boolean</span> result = <span class="keyword">true</span>;</span><br><span class="line">		<span class="comment">//测试用例的核心逻辑</span></span><br><span class="line">		<span class="comment">//测试用例开始</span></span><br><span class="line">		sr.sampleStart();</span><br><span class="line">		<span class="comment">//测试用例执行</span></span><br><span class="line">		MinaClient minaClient = <span class="keyword">new</span> MinaClient();</span><br><span class="line">		result = minaClient.search();</span><br><span class="line">		<span class="comment">//测试用例结果</span></span><br><span class="line">		sr.setSuccessful(result);</span><br><span class="line">		<span class="comment">//测试用例结束</span></span><br><span class="line">		sr.sampleEnd();</span><br><span class="line">		<span class="keyword">return</span> sr;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 测试开始</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupTest</span><span class="params">(JavaSamplerContext arg0)</span> </span>&#123;      </span><br><span class="line">		start = System.currentTimeMillis();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 测试结束</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teardownTest</span><span class="params">(JavaSamplerContext arg0)</span> </span>&#123;</span><br><span class="line">		end = System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"[time:"</span> + (end - start) / <span class="number">1000</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mina 的server代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.com.acsno.jmeter_data;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.filterchain.DefaultIoFilterChainBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.filter.codec.ProtocolCodecFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.filter.codec.textline.TextLineCodecFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.transport.socket.nio.NioSocketAcceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * <span class="doctag">@Description</span>:TODO</span><br><span class="line"> * <span class="doctag">@author</span>:difeng</span><br><span class="line"> * <span class="doctag">@time</span>:2016年1月7日 下午8:42:12</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinaServer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		NioSocketAcceptor acceptor = <span class="keyword">new</span> NioSocketAcceptor(); </span><br><span class="line">		MinaServerHandler handler = <span class="keyword">new</span> MinaServerHandler();</span><br><span class="line">		acceptor.setHandler(handler);  </span><br><span class="line">		<span class="comment">//创建接收数据的过滤器  </span></span><br><span class="line">        DefaultIoFilterChainBuilder chain = acceptor.getFilterChain();  </span><br><span class="line">        <span class="comment">//设定这个过滤器将一行一行(/r/n)的读取数据  </span></span><br><span class="line">        chain.addLast(<span class="string">"myChin"</span>, <span class="keyword">new</span> ProtocolCodecFilter(<span class="keyword">new</span>  </span><br><span class="line">        TextLineCodecFactory()));  </span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			acceptor.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">			System.out.println(<span class="string">"mina socket server start success!"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.service.IoHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.session.IdleStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.session.IoSession;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * <span class="doctag">@Description</span>:mina socket server </span><br><span class="line"> * <span class="doctag">@author</span>:difeng</span><br><span class="line"> * <span class="doctag">@time</span>:2016年1月7日 下午8:44:41</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinaServerHandler</span>  <span class="keyword">extends</span> <span class="title">IoHandlerAdapter</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * recieve message</span><br><span class="line">     * </span><br><span class="line">     */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">messageReceived</span><span class="params">(IoSession session, Object message)</span></span><br><span class="line">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(message);</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"hello"</span>.equals(message))&#123;</span><br><span class="line">		&#125;</span><br><span class="line">		session.write(<span class="string">"true"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionClosed</span><span class="params">(IoSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"会话关闭"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(IoSession session, Throwable cause)</span>  </span><br><span class="line">            <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"会话异常"</span>);  </span><br><span class="line">        <span class="keyword">super</span>.exceptionCaught(session, cause);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">messageSent</span><span class="params">(IoSession iosession, Object obj)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"服务端消息发送"</span>);  </span><br><span class="line">        <span class="keyword">super</span>.messageSent(iosession, obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(IoSession iosession)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"会话创建"</span>);  </span><br><span class="line">        <span class="keyword">super</span>.sessionCreated(iosession);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionIdle</span><span class="params">(IoSession iosession, IdleStatus idlestatus)</span>  </span><br><span class="line">            <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"会话休眠"</span>);  </span><br><span class="line">        <span class="keyword">super</span>.sessionIdle(iosession, idlestatus);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionOpened</span><span class="params">(IoSession iosession)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"会话打开"</span>);  </span><br><span class="line">        <span class="keyword">super</span>.sessionOpened(iosession);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mina client端的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.filterchain.DefaultIoFilterChainBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.future.ConnectFuture;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.service.IoConnector;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.filter.codec.ProtocolCodecFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.filter.codec.textline.TextLineCodecFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.transport.socket.nio.NioSocketConnector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@Description</span>:mina socket client</span><br><span class="line"> * <span class="doctag">@author</span>:difeng</span><br><span class="line"> * <span class="doctag">@time</span>:2016年1月7日 下午8:45:30</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinaClient</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> IoConnector connector;  </span><br><span class="line">	<span class="keyword">private</span> MinaClientHandler minaClientHandler;</span><br><span class="line">	<span class="keyword">private</span> ConnectFuture connFuture;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MinaClient</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">		connector = <span class="keyword">new</span> NioSocketConnector();  </span><br><span class="line">		minaClientHandler = <span class="keyword">new</span> MinaClientHandler();</span><br><span class="line">		connector.setHandler(minaClientHandler);  </span><br><span class="line">		 <span class="comment">// 创建接收数据的过滤器  </span></span><br><span class="line">        DefaultIoFilterChainBuilder chain = connector.getFilterChain();  </span><br><span class="line">        <span class="comment">//设定这个过滤器将一行一行(/r/n)的读取数据  </span></span><br><span class="line">        chain.addLast(<span class="string">"myChin"</span>, <span class="keyword">new</span> ProtocolCodecFilter(<span class="keyword">new</span>  </span><br><span class="line">        TextLineCodecFactory()));  </span><br><span class="line">        <span class="comment">// 设置链接超时时间       </span></span><br><span class="line"><span class="comment">//	    connector.setConnectTimeoutMillis(60*1000); </span></span><br><span class="line">		System.out.println(<span class="string">"TCP 客户端启动"</span>);  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> MinaClientHandler <span class="title">getMinaClientHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> minaClientHandler;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMinaClientHandler</span><span class="params">(MinaClientHandler minaClientHandler)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.minaClientHandler = minaClientHandler;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">		connFuture = connector.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>,<span class="number">8080</span>));  </span><br><span class="line">		connFuture.awaitUninterruptibly(<span class="number">5</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">		connFuture.getSession().write(message);</span><br><span class="line">		System.out.println(<span class="string">"send message :"</span>+message);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.connector.dispose();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.service.IoHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.session.IdleStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.mina.core.session.IoSession;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinaClientHandler</span> <span class="keyword">extends</span> <span class="title">IoHandlerAdapter</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String result;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MinaClientHandler</span><span class="params">()</span></span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">messageReceived</span><span class="params">(IoSession iosession, Object message)</span>  </span><br><span class="line">			<span class="keyword">throws</span> Exception </span>&#123;   </span><br><span class="line">		System.out.println(<span class="string">"客户端收到消息"</span> + message); </span><br><span class="line">		result = (String) message;</span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.result = result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(IoSession session, Throwable cause)</span>  </span><br><span class="line">			<span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">		System.out.println(<span class="string">"客户端异常"</span>);  </span><br><span class="line">		<span class="keyword">super</span>.exceptionCaught(session, cause);  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">messageSent</span><span class="params">(IoSession iosession, Object obj)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">		System.out.println(<span class="string">"客户端消息发送"</span>);  </span><br><span class="line">		<span class="keyword">super</span>.messageSent(iosession, obj);  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionClosed</span><span class="params">(IoSession iosession)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">		System.out.println(<span class="string">"客户端会话关闭"</span>);  </span><br><span class="line">		<span class="keyword">super</span>.sessionClosed(iosession);  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(IoSession iosession)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">		System.out.println(<span class="string">"客户端会话创建"</span>);  </span><br><span class="line">		<span class="keyword">super</span>.sessionCreated(iosession);  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionIdle</span><span class="params">(IoSession iosession, IdleStatus idlestatus)</span>  </span><br><span class="line">			<span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">		System.out.println(<span class="string">"客户端会话休眠"</span>);  </span><br><span class="line">		<span class="keyword">super</span>.sessionIdle(iosession, idlestatus);  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="annotation">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionOpened</span><span class="params">(IoSession iosession)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">		System.out.println(<span class="string">"客户端会话打开"</span>);  </span><br><span class="line">		<span class="keyword">super</span>.sessionOpened(iosession);  </span><br><span class="line">	&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.将编写好的代码编译完打成jar包,并且将其放到jmeter的\lib\ext目录中，依赖的jar包可以单独全都导出来放到本地的一个目录中，测试计划页面的右下方添加相应的依赖包就可以。如下图所示：<br><img src="http://7xawio.com1.z0.glb.clouddn.com/jmeter_dependency.png" alt="加载依赖jar包"><br>3.将mina的socket server启动起来，在线程组里添加的java请求并选择类名称如下图所示：<br><img src="http://7xawio.com1.z0.glb.clouddn.com/jmeter_mina_choose_request.png" alt="选择测试类"></p>
<p>4.添加聚合报告完后，就开以开始测试了。<br>测试过程截图如下：<br><img src="http://7xawio.com1.z0.glb.clouddn.com/jmeter_mina_test.png" alt="测试实例图"></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-03T12:36:16.000Z"><a href="/2016/01/03/redis-demo/">2016-01-03</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/03/redis-demo/">redis单机多实例使用</a></h1>
  

    </header>
    <div class="entry">
      
        <p>redis单机多实例的配置,其实也就是在多个端口上启动redis实例，学要注意以下问题。<br>1.不同端口写不同配置文件<br>   如下：<br>   redis_6377.conf<br>   redis_6378.conf<br>   redis_6379.conf<br>2.在不同的配置文件中配置各自的策略<br>  注意以下几点<br>  1.端口配置<br>  2.pid文件的配置，不同端口配不同名字，最好加端口号，以便区分。<br>  3.log文件路径的配置<br>  4.持久化的文件配置，不可重复<br>    这里选择rbd<br>启动的时候<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-server /path/to/redis.conf</span><br></pre></td></tr></table></figure></p>
<p>顺便说一下redis的持久化方式<br>分两种<br>1.rdb模式<br> 其实就是对内存中的东西按一些策略定期做snapshot,也就是快照<br>rdb保存的是二进制文件，是redis的默认方式。<br>配置如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save &#60;seconds&#62; &#60;changes&#62;&#10;#100&#31186;&#20869;&#33267;&#23569;&#26377;10&#20010;key&#20540;&#21457;&#29983;&#25913;&#21464;&#25165;&#20570;&#25345;&#20037;&#21270;&#10;save 100  10 &#10;#&#26368;&#26032;&#30340;&#24555;&#29031;&#20445;&#23384;&#22833;&#36133;&#26102;&#20572;&#27490;&#20889;&#25805;&#20316;&#10;stop-writes-on-bgsave-error yes&#10;#&#20570;&#24555;&#29031;&#26102;&#26159;&#19981;&#26159;&#38656;&#35201;&#20570;&#21387;&#32553;&#10;rdbcompression yes&#10;#&#25968;&#25454;&#26657;&#39564;&#65292;&#20445;&#35777;&#25968;&#25454;&#27491;&#30830;&#24615;&#10;rdbchecksum yes&#10;#&#24555;&#29031;&#30340;&#25991;&#20214;&#21517;&#10;dbfilename dump.rdb&#10;#&#23384;&#25918;&#24555;&#29031;&#30340;&#30446;&#24405;&#10;dir /var/lib/redis</span><br></pre></td></tr></table></figure></p>
<p>2.Append only file（AOF）的方式<br>  它将每一步操作的命令强制保存到磁盘上，持久性比较好，但对于写比较频繁的情况不适合，不推荐。 配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly no&#10;#append only file&#30340;&#21517;&#31216;,&#40664;&#35748;&#20026;appendonly.aof&#10;appendfilename &#34;appendonly.aof&#34;&#10;#&#22312;&#26085;&#24535;&#37325;&#20889;&#26102;&#65292;&#19981;&#36827;&#34892;&#21629;&#20196;&#36861;&#21152;&#25805;&#20316;&#65292;&#32780;&#21482;&#26159;&#23558;&#20854;&#25918;&#22312;&#32531;&#20914;&#21306;&#37324;&#65292;&#36991;&#20813;&#19982;&#21629;&#20196;&#30340;&#36861;&#21152;&#36896;&#25104;DISK IO&#19978;&#30340;&#20914;&#31361;&#12290;&#10;no-appendfsync-on-rewrite yes</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-12-27T14:32:36.000Z"><a href="/2015/12/27/log4j-study/">2015-12-27</a></time>
      
      
  
    <h1 class="title"><a href="/2015/12/27/log4j-study/">log4j的使用</a></h1>
  

    </header>
    <div class="entry">
      
        <p>log4j作为日志工具，想必大家已经非常熟悉，我们在日常的项目开发中经常会用到，它的功能很强大，我就不一一熬述了，把我觉得比较常用的功能总结一下。</p>
<h4 id="1-根日志属性项">1.根日志属性项</h4><pre><code><span class="title">level</span> 日志最低级别
后面可跟多个appender
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger  =   [ level ],appenderName1,appenderName2,...</span><br></pre></td></tr></table></figure>
<p>如下配置意思：定义输出源A1，它的最低日志级别为DEBUG，然后将它附到根日志的属性后面去，A1的日志文件的路径为E:\debug.log<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#### 日志级别 </span><br><span class="line">log4j.rootLogger=DEBUG,A1</span><br><span class="line">#### 日志文件按天产生</span><br><span class="line">log4j.appender.A1=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">#### 指定日志消息的输出最低层次</span><br><span class="line">log4j.appender.A1.Threshold=DEBUG</span><br><span class="line">#### 日志文件位置</span><br><span class="line">log4j.appender.A1.File=E:\\debug.log</span><br><span class="line">log4j.appender.A1.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.A1.Encoding=utf-8</span><br><span class="line">log4j.appender.A1.layout.ConversionPattern=[demo] %d %-5p %c %x - %m%n</span><br></pre></td></tr></table></figure></p>
<h4 id="2-按包或类单独打日志文件">2.按包或类单独打日志文件</h4><pre><code>定义单独包或类的日志输出源
设置子日志是否继承父日志,设置log4j.additivity的值设置规则如下：
log4j<span class="class">.additivity</span><span class="class">.cn</span><span class="class">.com</span><span class="class">.a1</span><span class="class">.TestB</span> = false
log4j.additivity后面跟上据体要设置的包或类，类得带完整的包路径
</code></pre><h4 id="以下是一个配置的demo">以下是一个配置的demo</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 日志级别 </span><br><span class="line">log4j.rootLogger=DEBUG,A1</span><br><span class="line">#### 日志文件按天产生</span><br><span class="line">log4j.appender.A1=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">#### 指定日志消息的输出最低层次</span><br><span class="line">log4j.appender.A1.Threshold=DEBUG</span><br><span class="line">#### 日志文件位置</span><br><span class="line">log4j.appender.A1.File=E:\\debug.log</span><br><span class="line">log4j.appender.A1.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.A1.Encoding=utf-8</span><br><span class="line">log4j.appender.A1.layout.ConversionPattern=[demo] %d %-5p %c %x - %m%n</span><br><span class="line"></span><br><span class="line">####false 子Logger只会在自己的appender里输出，而不会在父Logger的appender里输出。####</span><br><span class="line">#### 类cn.com.a1.TestB的日志只会打在自己的appender里而不会打到父appender里</span><br><span class="line">log4j.additivity.cn.com.a1.TestB = false </span><br><span class="line"></span><br><span class="line">log4j.appender.testb=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.testb.Threshold=DEBUG</span><br><span class="line">#### 类TestB的日志文件位置</span><br><span class="line">log4j.appender.testb.File=E:\\testb.log</span><br><span class="line">log4j.appender.testb.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.testb.Encoding=utf-8</span><br><span class="line">log4j.appender.testb.layout.ConversionPattern=[QiConsoleDaemon] %d %-5p %c %x - %m%n</span><br><span class="line">####单独定义某个包或类的日志输出级别和输出源，输出源可有多个，以逗号分隔，具体格式如下</span><br><span class="line">####日志级别，文件输出源</span><br><span class="line">log4j.logger.cn.com.a1.TestB=DEBUG,testb</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-11-19T13:22:31.000Z"><a href="/2015/11/19/storm-kafka-demo/">2015-11-19</a></time>
      
      
  
    <h1 class="title"><a href="/2015/11/19/storm-kafka-demo/">storm-kafka使用</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1-storm-kafka介绍">1.storm-kafka介绍</h3><p>storm-kafka是storm自带的从kafka上获取消息的kafka客户端程序。<br>提供kafka和Trident的spout实现从kafka消费数据。</p>
<h3 id="2-storm-kafka的使用实例">2.storm-kafka的使用实例</h3><p>maven的依赖配置文件,要注意strom-kafka是使用的kafka的低级api，因此也要引用kafka的包。如果不引，虽然编译不报错，但运行时会报错，我在初次使用时就是因为这个原因一直有问题。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.storm<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>storm-core<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">version</span>&gt;</span>0.9.5<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.storm<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>storm-kafka<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">version</span>&gt;</span>0.9.5<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>kafka_2.10<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">version</span>&gt;</span>0.8.1.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">exclusion</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">exclusion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>下面是我写的一个demo<br>具体步骤如下<br>1.new BrokerHosts<br>  需要的参数zookeeper的地址<br>2.new SpoutConfig<br> 构建SpoutConfig，需要设置BrokerHosts，kafka的topic，strom在zookeeper上的根等相关的参数。<br>3.new TopologyBuilder<br> 给TopologyBuilder设置Soupt和Boult用于构建一个Topology<br>4.配置Config并设置参数，启动LocalCluster，提交topology任务。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> storm.kafka.BrokerHosts;</span><br><span class="line"><span class="keyword">import</span> storm.kafka.KafkaSpout;</span><br><span class="line"><span class="keyword">import</span> storm.kafka.SpoutConfig;</span><br><span class="line"><span class="keyword">import</span> storm.kafka.StringScheme;</span><br><span class="line"><span class="keyword">import</span> storm.kafka.ZkHosts;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.Config;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.LocalCluster;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.spout.SchemeAsMultiScheme;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.task.OutputCollector;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.task.TopologyContext;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.topology.OutputFieldsDeclarer;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.topology.TopologyBuilder;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.topology.base.BaseRichBolt;</span><br><span class="line"><span class="keyword">import</span> backtype.storm.tuple.Tuple;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * <span class="doctag">@Description</span>:strom-kafka 使用</span><br><span class="line"> * <span class="doctag">@author</span>:duyongfeng</span><br><span class="line"> * <span class="doctag">@time</span>:2015年11月18日 上午10:18:31</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StormKafkaConsumer</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PingCounter</span> <span class="keyword">extends</span> <span class="title">BaseRichBolt</span></span>&#123;</span><br><span class="line">		<span class="comment">/**</span><br><span class="line">		 * </span><br><span class="line">		 */</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">		<span class="keyword">private</span> OutputCollector collector;</span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Tuple input)</span> </span>&#123;</span><br><span class="line">			String msg = input.getString(<span class="number">0</span>);</span><br><span class="line">			System.out.println(<span class="string">"---------------------"</span> + msg + <span class="string">"-----------------"</span>);</span><br><span class="line">			collector.ack(input);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(Map arg0, TopologyContext arg1, OutputCollector arg2)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.collector = arg2;</span><br><span class="line">            System.out.println(<span class="string">"++++++++++++++++++++prepare++++++++++++++++++++++++++++++++++"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">declareOutputFields</span><span class="params">(OutputFieldsDeclarer arg0)</span> </span>&#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			 System.out.println(<span class="string">"++++++++++++++++++++declareOutputFields+++++++++++++++++++++"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	    <span class="comment">//zookeeper的服务器地址</span></span><br><span class="line">		String zks = <span class="string">"192.168.1.50:2181,192.168.1.57:2181,192.168.1.58:2181"</span>;</span><br><span class="line">	    <span class="comment">//消息的topic</span></span><br><span class="line">		String topic = <span class="string">"data_icmp_ping"</span>;</span><br><span class="line">		<span class="comment">//strom在zookeeper上的根</span></span><br><span class="line">		String zkRoot = <span class="string">"/storm"</span>; </span><br><span class="line">		String id = <span class="string">"data_icmp_ping"</span>;</span><br><span class="line">		BrokerHosts brokerHosts = <span class="keyword">new</span> ZkHosts(zks);</span><br><span class="line">		SpoutConfig spoutConf = <span class="keyword">new</span> SpoutConfig(brokerHosts, topic, zkRoot, id);</span><br><span class="line">		spoutConf.scheme = <span class="keyword">new</span> SchemeAsMultiScheme(<span class="keyword">new</span> StringScheme());</span><br><span class="line">		spoutConf.forceFromStart = <span class="keyword">true</span>;</span><br><span class="line">		spoutConf.zkServers = Arrays.asList(<span class="keyword">new</span> String[] &#123;<span class="string">"192.168.1.50,192.168.1.57,192.168.1.58"</span>&#125;);</span><br><span class="line">		spoutConf.zkPort = <span class="number">2181</span>;</span><br><span class="line">		</span><br><span class="line">		TopologyBuilder builder = <span class="keyword">new</span> TopologyBuilder();</span><br><span class="line">		builder.setSpout(<span class="string">"kafka-reader"</span>, <span class="keyword">new</span> KafkaSpout(spoutConf),<span class="number">3</span>); </span><br><span class="line">		builder.setBolt(<span class="string">"ping-counter"</span>, <span class="keyword">new</span> PingCounter(),<span class="number">3</span>).shuffleGrouping(<span class="string">"kafka-reader"</span>);</span><br><span class="line">		Config conf = <span class="keyword">new</span> Config();</span><br><span class="line">        conf.setDebug(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//设置任务线程数</span></span><br><span class="line">        conf.setMaxTaskParallelism(<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        LocalCluster cluster = <span class="keyword">new</span> LocalCluster();</span><br><span class="line">		cluster.submitTopology(<span class="string">"test"</span>, conf, builder.createTopology());</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">60000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		cluster.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-10-05T08:25:44.000Z"><a href="/2015/10/05/design-pattern-observer/">2015-10-05</a></time>
      
      
  
    <h1 class="title"><a href="/2015/10/05/design-pattern-observer/">observer(观察者模式)-对象行为模式</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="意图：">意图：</h4><p>定义对象之间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到该状态通知并自动更新。</p>
<h5 id="适用性：">适用性：</h5><blockquote>
<ul>
<li>一个抽象模型有两个方面，其中一个方面依赖于另一个方面。将两者封装为独立的对象以使他们可以各自独立地改变和复用。</li>
<li>当一个对象的改变学要同时影响到其他对象，而不知道有具体多少个对象有待改变。</li>
<li>当一个对象必须通知其他对象，而他又不能假定其他对象是谁，换言之，你不希望这些对象是耦合的。</li>
</ul>
</blockquote>
<h5 id="结构图：">结构图：</h5><p><img src="http://7xawio.com1.z0.glb.clouddn.com/design_pattern_observer.png" alt="img"></p>
<h4 id="抽象的主题">抽象的主题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	List&lt;Observer&gt; observerList = <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 * add the observer</span><br><span class="line">	 * <span class="doctag">@param</span> observer</span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attach</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">		observerList.add(observer);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 *delete the observer</span><br><span class="line">	 * <span class="doctag">@param</span> observer</span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Detach</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(Observer curObserver:observerList)&#123;</span><br><span class="line">			<span class="keyword">if</span>(curObserver == observer)&#123;</span><br><span class="line">				observerList.remove(observerList.indexOf(observer));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 * notify observer</span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Observer curObserver:observerList)&#123;</span><br><span class="line">			curObserver.update();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="具体的主题">具体的主题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="keyword">extends</span> <span class="title">Subject</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String subjectState;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> subjectState;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String subjectState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subjectState = subjectState;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="抽象的观察者：">抽象的观察者：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">	   <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="具体的观察者：">具体的观察者：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String observerName;</span><br><span class="line">    <span class="keyword">private</span> String observerState;</span><br><span class="line">	<span class="keyword">private</span> ConcreteSubject subject;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getObserverName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> observerName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObserverName</span><span class="params">(String observerName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.observerName = observerName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getObserverState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> observerState;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObserverState</span><span class="params">(String observerState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.observerState = observerState;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteObserver</span><span class="params">(ConcreteSubject subject,String observerName)</span></span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.subject = subject;</span><br><span class="line">    	<span class="keyword">this</span>.observerName = observerName;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		observerState = subject.getState();</span><br><span class="line">	    System.out.println(<span class="string">"I'am "</span> + observerName + <span class="string">",I see  concreteSubject has a state change:"</span> + observerState);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端调用：">客户端调用：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</span><br><span class="line">    	   ConcreteSubject concreteSubject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line">    	   Observer  observer1 = <span class="keyword">new</span> ConcreteObserver(concreteSubject,<span class="string">"observer1"</span>);</span><br><span class="line">    	   Observer  observer2 = <span class="keyword">new</span> ConcreteObserver(concreteSubject,<span class="string">"observer2"</span>);</span><br><span class="line">    	   Observer  observer3 = <span class="keyword">new</span> ConcreteObserver(concreteSubject,<span class="string">"observer3"</span>);</span><br><span class="line">    	   concreteSubject.Attach(observer1);</span><br><span class="line">    	   concreteSubject.Attach(observer2);</span><br><span class="line">    	   concreteSubject.Attach(observer3);</span><br><span class="line">    	   concreteSubject.setState(<span class="string">"I am running"</span>);</span><br><span class="line">    	   concreteSubject.notifyObserver();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-29T15:05:55.000Z"><a href="/2015/09/29/design-pattern-memento/">2015-09-29</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/29/design-pattern-memento/">memento（备忘录）-对象行为模式</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="意图：">意图：</h4><p>在不破坏分装性的前提下，捕获一个对象的内部状态，并在改对象的外部保存。</p>
<h4 id="适用性：">适用性：</h4><blockquote>
<ul>
<li>必须保存一个对象在某一个时刻的（部分）状态，这样以后需要时它才能恢复到先前之前的状态。</li>
<li>如果一个用接口来让其他对象直接得到这些状态，将会暴漏对象的实现细节并破坏对象的封装性。</li>
</ul>
</blockquote>
<p>结构：<br><img src="http://7xawio.com1.z0.glb.clouddn.com/design_pattern_memento.png" alt="img"></p>
<h4 id="原发者:">原发者:</h4><p>原发者，也就是需要备忘录的一类对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Originator</span> </span>&#123;</span><br><span class="line">   <span class="comment">//原发者的状态</span></span><br><span class="line">	Object state;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(Memento memento)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = memento.getState();</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//创建备忘录</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento  <span class="title">createMemento</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Memento(state);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="备忘录：">备忘录：</h4><p>用来记录原发者的内部状态<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">Memento</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> Object state;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">Memento</span><span class="params">(Object state)</span></span>&#123;</span><br><span class="line">    	  <span class="keyword">this</span>.state = state;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> Object <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	  <span class="keyword">return</span> <span class="keyword">this</span>.state;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(Object state)</span></span>&#123;</span><br><span class="line">    	  <span class="keyword">this</span>.state = state;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="守护者：">守护者：</h4><p>使用备忘录记录原发者的信息<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Caretaker</span> </span>&#123;</span><br><span class="line">	Memento memento = <span class="keyword">new</span> Memento(); </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(Memento memento)</span></span>&#123;</span><br><span class="line">     	<span class="keyword">this</span>.memento = memento;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">getMemento</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stack.pop();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="客户端">客户端</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">	    <span class="comment">//创建状态守护者</span></span><br><span class="line">        Caretaker taker = <span class="keyword">new</span> Caretaker();</span><br><span class="line">        <span class="comment">//创建原发者</span></span><br><span class="line">        Originator orig = <span class="keyword">new</span> Originator();</span><br><span class="line">        <span class="comment">//原发者设置状态</span></span><br><span class="line">        orig.state = <span class="string">"open"</span>;</span><br><span class="line">        System.out.println(<span class="string">"origin's state  is "</span> + orig.state);</span><br><span class="line">        <span class="comment">//守护者保存原发者的状态</span></span><br><span class="line">        taker.save(orig.createMemento());</span><br><span class="line">        <span class="comment">//守护者恢复原发者的状态</span></span><br><span class="line">        orig.setMemento(taker.resume());</span><br><span class="line">        System.out.println(<span class="string">"after resume,originator's state  is "</span> + orig.state);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-05T09:39:50.000Z"><a href="/2015/09/05/design-pattern-builder/">2015-09-05</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/05/design-pattern-builder/">Builder(生成器)-对象创建型模式</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="意图：">意图：</h4><p>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示</p>
<h4 id="适用性：">适用性：</h4><blockquote>
<ul>
<li>在以下情况使用Builder模式</li>
<li>当创建负载对象的算法应该独立于该对象的组成部分以及他们的装配方式</li>
<li>当构造的过程必须允许被构造的对象有不同的表示时</li>
</ul>
</blockquote>
<h4 id="结构：">结构：</h4><p><img src="http://7xawio.com1.z0.glb.clouddn.com/design_pattern_builder_demo1.png" alt="img"></p>
<h4 id="实现：">实现：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildPart1</span><span class="params">()</span></span>;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildPart2</span><span class="params">()</span></span>;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Product  <span class="title">getResult</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Product product = <span class="keyword">new</span> Product();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> product;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPart1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		product.setPart1(<span class="string">"part1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPart2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		product.setPart2(<span class="string">"part2"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Object part1;</span><br><span class="line">	<span class="keyword">private</span> Object part2;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getPart1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> part1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPart1</span><span class="params">(Object part1)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.part1 = part1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getPart2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> part2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPart2</span><span class="params">(Object part2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.part2 = part2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span>  Builder builder;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span></span>&#123;</span><br><span class="line">    	   <span class="keyword">this</span>.builder = builder;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> Product <span class="title">construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	   String [] parts = &#123;<span class="string">"part1"</span>,<span class="string">"part2"</span>&#125;;</span><br><span class="line">    	   <span class="keyword">for</span>(String part:parts)&#123;</span><br><span class="line">    		  <span class="keyword">if</span>(<span class="string">"part1"</span>.equals(part))&#123;</span><br><span class="line">    			  builder.buildPart1();</span><br><span class="line">    		  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    			  builder.buildPart2();</span><br><span class="line">    		  &#125;</span><br><span class="line">    	   &#125;</span><br><span class="line">    	   <span class="keyword">return</span> builder.getResult();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</span><br><span class="line">        ConcreteBuilder concreteBuilder = <span class="keyword">new</span> ConcreteBuilder();</span><br><span class="line">        Director director = <span class="keyword">new</span> Director(concreteBuilder);</span><br><span class="line">        Product product = director.construct();</span><br><span class="line">        System.out.println(product.getPart1() + <span class="string">","</span> + product.getPart2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一頁</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">標籤</h3>
  <ul class="entry">
  
    <li><a href="/tags/SOA框架dubbo/">SOA框架dubbo</a><small>1</small></li>
  
    <li><a href="/tags/java多线程/">java多线程</a><small>1</small></li>
  
    <li><a href="/tags/java并发编程/">java并发编程</a><small>1</small></li>
  
    <li><a href="/tags/jmeter/">jmeter</a><small>1</small></li>
  
    <li><a href="/tags/jvm监控/">jvm监控</a><small>1</small></li>
  
    <li><a href="/tags/markdown编辑器/">markdown编辑器</a><small>1</small></li>
  
    <li><a href="/tags/mysql数据库/">mysql数据库</a><small>2</small></li>
  
    <li><a href="/tags/node/">node</a><small>1</small></li>
  
    <li><a href="/tags/redis/">redis</a><small>1</small></li>
  
    <li><a href="/tags/spring/">spring</a><small>1</small></li>
  
    <li><a href="/tags/storm/">storm</a><small>1</small></li>
  
    <li><a href="/tags/分形学/">分形学</a><small>1</small></li>
  
    <li><a href="/tags/日志工具/">日志工具</a><small>1</small></li>
  
    <li><a href="/tags/算法/">算法</a><small>1</small></li>
  
    <li><a href="/tags/设计模式/">设计模式</a><small>6</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 difeng
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>